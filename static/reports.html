<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–û—Ç—á–µ—Ç—ã ‚Äî –ú–∏–∫—Ä–æ–∫–ª–∏–º–∞—Ç</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --success: #06d6a0;
      --danger: #ef476f;
      --warning: #ffd166;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --card-bg: white;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --radius: 16px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #f0f4f8;
      color: var(--dark);
      line-height: 1.6;
      padding: 16px;
      max-width: 1000px;
      margin: 0 auto;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 24px;
      padding-top: 8px;
    }
    h1 {
      font-size: 1.8em;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 6px;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 20px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 18px;
      border: none;
      border-radius: 10px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      color: white;
      transition: all 0.2s;
    }
    .btn-primary { background: var(--primary); }
    .btn-success { background: var(--success); }
    .btn-warning { background: var(--warning); color: var(--dark); }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    .form-group {
      margin: 16px 0;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }
    select, input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
    }
    .report-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    .option-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    .option-card:hover {
      border-color: var(--primary);
      background: #e3f2fd;
    }
    .option-card.selected {
      border-color: var(--primary);
      background: #e3f2fd;
    }
    .option-icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .stat-value {
      font-size: 1.8em;
      font-weight: 700;
      margin: 5px 0;
    }
    .stat-label {
      font-size: 0.8em;
      color: var(--gray);
    }
    .comparison-result {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .change-indicator {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 600;
    }
    .change-up { background: #ffebee; color: var(--danger); }
    .change-down { background: #e8f5e8; color: var(--success); }
    .change-stable { background: #fff8e1; color: #f57c00; }
    .hourly-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    .hourly-table th,
    .hourly-table td {
      padding: 8px 12px;
      text-align: center;
      border: 1px solid #e0e0e0;
    }
    .hourly-table th {
      background: var(--primary);
      color: white;
    }
    .hourly-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--gray);
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤</h1>
      <div class="subtitle">PDF-–æ—Ç—á–µ—Ç—ã, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
    </div>
    <a href="help.html" class="btn btn-outline" style="padding:8px 12px; font-size:0.9em; width:auto;">üìû –ü–æ–º–æ—â—å</a>
  </header>

  <div class="card">
    <h3>üìä –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞</h3>
    
    <div class="report-options">
      <div class="option-card" data-report-type="pdf">
        <div class="option-icon">üìÑ</div>
        <h4>PDF –û—Ç—á–µ—Ç</h4>
        <p>–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ PDF —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏</p>
      </div>
      
      <div class="option-card" data-report-type="compare">
        <div class="option-icon">üìä</div>
        <h4>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤</h4>
        <p>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏</p>
      </div>
      
      <div class="option-card" data-report-type="hourly">
        <div class="option-icon">‚è∞</div>
        <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∞—Å–∞–º</h4>
        <p>–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –∏ –≤—ã—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–µ–π</p>
      </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–∏–æ–¥–∞ -->
    <div class="form-group">
      <label for="reportPeriod">üìÖ –ü–µ—Ä–∏–æ–¥ –æ—Ç—á–µ—Ç–∞</label>
      <select id="reportPeriod">
        <option value="day">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞</option>
        <option value="week" selected>–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é</option>
        <option value="month">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</option>
        <option value="all">–ó–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥</option>
      </select>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è PDF –æ—Ç—á–µ—Ç–∞ -->
    <div id="pdfContent" class="report-content">
      <button class="btn btn-primary" id="generatePdf">
        üéØ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF –æ—Ç—á–µ—Ç
      </button>
      <div id="pdfResult" style="margin-top: 15px;"></div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤ -->
    <div id="compareContent" class="report-content" style="display: none;">
      <div class="form-group">
        <label>–°—Ä–∞–≤–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥—ã:</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <select id="comparePeriod1">
            <option value="day">24 —á–∞—Å–∞</option>
            <option value="week" selected>–ù–µ–¥–µ–ª—è</option>
            <option value="month">–ú–µ—Å—è—Ü</option>
          </select>
          <select id="comparePeriod2">
            <option value="week">–ù–µ–¥–µ–ª—è</option>
            <option value="month" selected>–ú–µ—Å—è—Ü</option>
            <option value="all">–í–µ—Å—å –ø–µ—Ä–∏–æ–¥</option>
          </select>
        </div>
      </div>
      <button class="btn btn-primary" id="comparePeriods">
        üìä –°—Ä–∞–≤–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥—ã
      </button>
      <div id="compareResult" style="margin-top: 15px;"></div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="hourlyContent" class="report-content" style="display: none;">
      <button class="btn btn-outline" id="loadHourlyStats">
        ‚è∞ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —á–∞—Å–∞–º
      </button>
      <div id="hourlyResult" style="margin-top: 15px;"></div>
    </div>
  </div>

  <a href="#" id="backToMonitor" class="btn btn-outline" style="display:block; text-align:center; margin-top:16px; width:auto; margin-left:auto; margin-right:auto;">
    ‚óÄÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É
  </a>

  <script src="profile.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const deviceId = urlParams.get('device');
    let currentReportType = 'pdf';
    
    if (!deviceId) {
      const lastDeviceId = localStorage.getItem('lastDeviceId');
      if (lastDeviceId) {
        window.location.href = `reports.html?device=${lastDeviceId}`;
      } else {
        alert('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ.');
        window.location.href = 'dashboard.html';
      }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É"
    document.getElementById('backToMonitor').href = `index.html?device=${deviceId}`;

    // –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–∞
    document.querySelectorAll('.option-card').forEach(card => {
      card.addEventListener('click', () => {
        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
        // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É
        card.classList.add('selected');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã
        document.querySelectorAll('.report-content').forEach(content => {
          content.style.display = 'none';
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        currentReportType = card.dataset.reportType;
        document.getElementById(`${currentReportType}Content`).style.display = 'block';
      });
    });

    // –í—ã–±–∏—Ä–∞–µ–º PDF –æ—Ç—á–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.querySelector('.option-card[data-report-type="pdf"]').click();

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á–µ—Ç–∞
    document.getElementById('generatePdf').addEventListener('click', async function() {
      const button = this;
      const period = document.getElementById('reportPeriod').value;
      
      button.innerHTML = '‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...';
      button.disabled = true;
      
      try {
        const response = await fetch(`/api/device/${deviceId}/report/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ period, type: 'summary' })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF
          const pdfBlob = base64ToBlob(data.pdf_data, 'application/pdf');
          const url = URL.createObjectURL(pdfBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = data.filename;
          link.click();
          
          // –û—á–∏—â–∞–µ–º URL
          setTimeout(() => URL.revokeObjectURL(url), 100);
          
          document.getElementById('pdfResult').innerHTML = `
            <div style="color: var(--success); font-weight: 600;">
              ‚úÖ PDF –æ—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω!
            </div>
          `;
        } else {
          document.getElementById('pdfResult').innerHTML = `
            <div style="color: var(--danger);">
              ‚ùå –û—à–∏–±–∫–∞: ${data.error}
            </div>
          `;
        }
      } catch (error) {
        document.getElementById('pdfResult').innerHTML = `
          <div style="color: var(--danger);">
            ‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
          </div>
        `;
      } finally {
        button.innerHTML = 'üéØ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF –æ—Ç—á–µ—Ç';
        button.disabled = false;
      }
    });

    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤
    document.getElementById('comparePeriods').addEventListener('click', async function() {
      const button = this;
      const period1 = document.getElementById('comparePeriod1').value;
      const period2 = document.getElementById('comparePeriod2').value;
      
      button.innerHTML = '‚è≥ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ...';
      button.disabled = true;
      
      try {
        const response = await fetch(`/api/device/${deviceId}/report/compare`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ period1, period2 })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          displayComparisonResult(data, period1, period2);
        } else {
          document.getElementById('compareResult').innerHTML = `
            <div style="color: var(--danger);">
              ‚ùå –û—à–∏–±–∫–∞: ${data.error}
            </div>
          `;
        }
      } catch (error) {
        document.getElementById('compareResult').innerHTML = `
          <div style="color: var(--danger);">
            ‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
          </div>
        `;
      } finally {
        button.innerHTML = 'üìä –°—Ä–∞–≤–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥—ã';
        button.disabled = false;
      }
    });

    // –ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    document.getElementById('loadHourlyStats').addEventListener('click', async function() {
      const button = this;
      const period = document.getElementById('reportPeriod').value;
      
      button.innerHTML = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
      button.disabled = true;
      
      try {
        const response = await fetch(`/api/device/${deviceId}/report/hourly-stats?period=${period}`);
        const data = await response.json();
        
        if (response.ok) {
          displayHourlyStats(data);
        } else {
          document.getElementById('hourlyResult').innerHTML = `
            <div style="color: var(--danger);">
              ‚ùå –û—à–∏–±–∫–∞: ${data.error}
            </div>
          `;
        }
      } catch (error) {
        document.getElementById('hourlyResult').innerHTML = `
          <div style="color: var(--danger);">
            ‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
          </div>
        `;
      } finally {
        button.innerHTML = '‚è∞ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —á–∞—Å–∞–º';
        button.disabled = false;
      }
    });

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function base64ToBlob(base64, contentType) {
      const byteCharacters = atob(base64);
      const byteArrays = [];
      
      for (let offset = 0; offset < byteCharacters.length; offset += 512) {
        const slice = byteCharacters.slice(offset, offset + 512);
        const byteNumbers = new Array(slice.length);
        for (let i = 0; i < slice.length; i++) {
          byteNumbers[i] = slice.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        byteArrays.push(byteArray);
      }
      
      return new Blob(byteArrays, { type: contentType });
    }

    function displayComparisonResult(data, period1, period2) {
      const changes = data.changes;
      const insights = data.insights || [];
      
      let html = `
        <div class="comparison-result">
          <h4>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ: ${period1} vs ${period2}</h4>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
              <div class="stat-value">${changes.temp_mean.absolute > 0 ? '+' : ''}${changes.temp_mean.absolute}¬∞C</div>
              <div class="change-indicator ${getChangeClass(changes.temp_mean.trend)}">
                ${getChangeIcon(changes.temp_mean.trend)} ${changes.temp_mean.percent}%
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
              <div class="stat-value">${changes.hum_mean.absolute > 0 ? '+' : ''}${changes.hum_mean.absolute}%</div>
              <div class="change-indicator ${getChangeClass(changes.hum_mean.trend)}">
                ${getChangeIcon(changes.hum_mean.trend)} ${changes.hum_mean.percent}%
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-label">–û—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å</div>
              <div class="stat-value">${changes.lux_mean.absolute > 0 ? '+' : ''}${changes.lux_mean.absolute} –ª–∫</div>
              <div class="change-indicator ${getChangeClass(changes.lux_mean.trend)}">
                ${getChangeIcon(changes.lux_mean.trend)} ${changes.lux_mean.percent}%
              </div>
            </div>
          </div>
      `;
      
      if (insights.length > 0) {
        html += `<h5>üí° –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:</h5><ul style="margin-top: 10px;">`;
        insights.forEach(insight => {
          html += `<li>${insight}</li>`;
        });
        html += `</ul>`;
      }
      
      html += `</div>`;
      document.getElementById('compareResult').innerHTML = html;
    }

    function displayHourlyStats(data) {
      const stats = data.hourly_stats;
      const summary = data.summary;
      
      let html = `
        <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ (${data.period})</h4>
        
        <div class="stats-grid" style="margin: 20px 0;">
          <div class="stat-card">
            <div class="stat-label">–°–∞–º—ã–π –∂–∞—Ä–∫–∏–π —á–∞—Å</div>
            <div class="stat-value" style="font-size: 1.2em;">${summary.hottest_hour}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–°–∞–º—ã–π —Ö–æ–ª–æ–¥–Ω—ã–π —á–∞—Å</div>
            <div class="stat-value" style="font-size: 1.2em;">${summary.coldest_hour}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–ü–µ—Ä–µ–ø–∞–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</div>
            <div class="stat-value" style="font-size: 1.2em;">${summary.temp_variation}¬∞C</div>
          </div>
        </div>
        
        <h5>–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∞—Å–∞–º:</h5>
        <table class="hourly-table">
          <thead>
            <tr>
              <th>–ß–∞—Å</th>
              <th>–¢–µ–º–ø. —Å—Ä–µ–¥.</th>
              <th>–¢–µ–º–ø. –æ—Ç–∫–ª.</th>
              <th>–í–ª. —Å—Ä–µ–¥.</th>
              <th>–í–ª. –æ—Ç–∫–ª.</th>
              <th>–ó–∞–º–µ—Ä–æ–≤</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      stats.forEach(stat => {
        html += `
          <tr>
            <td><strong>${stat.hour}:00</strong></td>
            <td>${stat.temp_avg.toFixed(1)}¬∞C</td>
            <td>¬±${stat.temp_std.toFixed(1)}</td>
            <td>${stat.hum_avg.toFixed(1)}%</td>
            <td>¬±${stat.hum_std.toFixed(1)}</td>
            <td>${stat.count}</td>
          </tr>
        `;
      });
      
      html += `</tbody></table>`;
      document.getElementById('hourlyResult').innerHTML = html;
    }

    function getChangeClass(trend) {
      switch(trend) {
        case 'up': return 'change-up';
        case 'down': return 'change-down';
        default: return 'change-stable';
      }
    }

    function getChangeIcon(trend) {
      switch(trend) {
        case 'up': return 'üìà';
        case 'down': return 'üìâ';
        default: return '‚û°Ô∏è';
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    (async () => {
      if (!isUserLoggedIn()) {
        window.location.href = 'login.html';
        return;
      }
    })();
  </script>
</body>
</html>