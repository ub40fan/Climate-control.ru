<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–∏–∫—Ä–æ–∫–ª–∏–º–∞—Ç ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --success: #06d6a0;
      --danger: #ef476f;
      --warning: #ffd166;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --card-bg: white;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --radius: 16px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #f0f4f8;
      color: var(--dark);
      line-height: 1.6;
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 24px;
      padding-top: 8px;
    }
    h1 {
      font-size: 1.8em;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .subtitle {
      color: var(--gray);
      font-size: 0.95em;
      flex: 1 1 100%;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.2s;
    }
    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    .metric {
      text-align: center;
      padding: 16px;
      border-top: 4px solid transparent;
    }
    .metric--comfort { border-top-color: var(--success); background: #f0f9f4; }
    .metric--warning { border-top-color: var(--warning); background: #fff8e1; }
    .metric--danger  { border-top-color: var(--danger);  background: #ffebee; }
    .metric-value {
      font-size: 1.8em;
      font-weight: 700;
    }
    .metric-label {
      font-size: 0.9em;
      margin-top: 4px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 20px;
      border: 2px solid var(--primary);
      border-radius: 12px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      min-height: 52px;
    }
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    .btn-success {
      background: var(--success);
      color: var(--dark);
    }
    .btn-outline {
      background: transparent;
      color: var(--primary);
    }
    .btn.active {
      background: var(--primary);
      color: white;
    }
    .btn.inactive {
      background: transparent;
      color: var(--primary);
    }
    .btn-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }
    canvas {
      max-width: 100%;
      height: 240px !important;
      margin-top: 16px;
    }
    .legend {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      font-size: 0.85em;
      color: var(--gray);
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }
    .legend-comfort .legend-color { background: var(--success); }
    .legend-warning .legend-color { background: var(--warning); }
    .legend-danger .legend-color { background: var(--danger); }
    footer {
      text-align: center;
      color: var(--gray);
      font-size: 0.85em;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    .hint {
      font-size: 0.85em;
      color: var(--gray);
      margin-top: 6px;
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>üå°Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∏–∫—Ä–æ–∫–ª–∏–º–∞—Ç–∞</h1>
      
    </div>
    <a href="help.html" class="btn btn-outline" style="padding:8px 12px; font-size:0.9em;">üìû –ü–æ–º–æ—â—å</a>
  </header>

  <div class="card">
    <div class="metric-grid">
      <div class="metric metric--comfort">
        <div class="metric-value">20.5</div>
        <div class="metric-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
        <div>¬∞C</div>
      </div>
      <div class="metric metric--warning">
        <div class="metric-value">53.2</div>
        <div class="metric-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
        <div>%</div>
      </div>
      <div class="metric metric--danger">
        <div class="metric-value">180</div>
        <div class="metric-label">–û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å</div>
        <div>–ª–∫</div>
      </div>
    </div>
    <p>–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ <strong>30 –º–∏–Ω—É—Ç</strong></p>
    <div class="legend">
      <div class="legend-item legend-comfort">
        <div class="legend-color"></div>
        <span>–ö–æ–º—Ñ–æ—Ä—Ç</span>
      </div>
      <div class="legend-item legend-warning">
        <div class="legend-color"></div>
        <span>–†–∏—Å–∫</span>
      </div>
      <div class="legend-item legend-danger">
        <div class="legend-color"></div>
        <span>–ö—Ä–∏—Ç–∏—á–Ω–æ</span>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin-bottom:16px;">üìà –ü—Ä–æ—Å–º–æ—Ç—Ä –≥—Ä–∞—Ñ–∏–∫–æ–≤</h2>
    <p style="margin-bottom:12px; color:#555;">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –∏ –ø–µ—Ä–∏–æ–¥:</p>

    <div class="btn-group" id="paramButtons">
      <button class="btn btn-outline" data-param="temp">üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</button>
      <button class="btn btn-outline" data-param="hum">üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å</button>
      <button class="btn btn-outline" data-param="lux">‚òÄÔ∏è –û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å</button>
    </div>

    <p id="paramHint" class="hint" style="margin-top:12px; display:none;">
      –í—ã–±—Ä–∞–Ω–æ: <span id="paramName">...</span>
    </p>

    <div id="periodButtons" style="display:none; margin-top:12px;">
      <div class="btn-group">
        <button class="btn btn-outline" data-period="day">–ó–∞ –¥–µ–Ω—å</button>
        <button class="btn btn-outline" data-period="week">–ó–∞ –Ω–µ–¥–µ–ª—é</button>
        <button class="btn btn-outline" data-period="month">–ó–∞ –º–µ—Å—è—Ü</button>
        <button class="btn btn-outline" data-period="all">–ó–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥</button>
      </div>
    </div>
    <canvas id="climateChart"></canvas>
  </div>

  <div class="card">
    <h2 style="margin-bottom:16px;">üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
    <div class="btn-group">
      <a href="settings.html" class="btn btn-primary">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å</a>
      <a href="download.html" class="btn btn-success">üì• –û—Ç—á—ë—Ç—ã</a>
    </div>
    <div style="margin-top:16px; text-align:center;">
      <a href="dashboard.html" class="btn btn-outline">üè† –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
    </div>
  </div>

  <footer>
    IoT-—Å–∏—Å—Ç–µ–º–∞ ‚Ä¢ –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –æ—Ç 1.5 –¥–æ 2.5 –ª–µ—Ç ‚Ä¢ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ì–û–°–¢ –† 57913-2017
  </footer>

  <script>
    // Mock login function for demo
    function isUserLoggedIn() {
      return true; // For demo purposes
    }

    // Mock localStorage.getItem for demo
    function getSavedInterval() {
      return '30'; // For demo purposes
    }

    const savedInterval = getSavedInterval();
    document.querySelector('p').innerHTML = `–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ <strong>${savedInterval} –º–∏–Ω—É—Ç</strong>`;

    let currentParam = null;
    let currentPeriod = null;
    let climateChart = null;

    function getZoneColor(value, param) {
      if (param === 'temp') {
        if (value >= 19 && value <= 21) return 'success';
        if (value >= 17 && value <= 23) return 'warning';
        return 'danger';
      }
      if (param === 'hum') {
        if (value >= 47.5 && value <= 52.5) return 'success';
        if (value >= 45 && value <= 55) return 'warning';
        return 'danger';
      }
      if (param === 'lux') {
        if (value <= 75) return 'success';
        if (value <= 150) return 'warning';
        return 'danger';
      }
      return 'success';
    }

    // Parameter button activation
    document.querySelectorAll('#paramButtons .btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#paramButtons .btn').forEach(b => {
          b.classList.replace('btn-primary', 'btn-outline');
        });
        btn.classList.replace('btn-outline', 'btn-primary');
        currentParam = btn.dataset.param;
        document.getElementById('paramName').textContent = {
          temp: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
          hum: '–í–ª–∞–∂–Ω–æ—Å—Ç—å',
          lux: '–û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å'
        }[currentParam];
        document.getElementById('paramHint').style.display = 'block';
        document.getElementById('periodButtons').style.display = 'block';
        
        // Select first period button by default
        const firstPeriodBtn = document.querySelector('#periodButtons .btn');
        if (firstPeriodBtn) {
          document.querySelectorAll('#periodButtons .btn').forEach(b => {
            b.classList.replace('btn-primary', 'btn-outline');
          });
          firstPeriodBtn.classList.replace('btn-outline', 'btn-primary');
          currentPeriod = firstPeriodBtn.dataset.period;
          loadChart(currentPeriod);
        }
      });
    });

    // Period button activation
    document.querySelectorAll('#periodButtons .btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#periodButtons .btn').forEach(b => {
          b.classList.replace('btn-primary', 'btn-outline');
        });
        btn.classList.replace('btn-outline', 'btn-primary');
        currentPeriod = btn.dataset.period;
        if (currentParam) {
          loadChart(currentPeriod);
        }
      });
    });

    function loadChart(period) {
      const demo = {
        temp: { day: [20,21,22,23,22], week: [21,22,22,23,22,21,20], all: [20,21,22,23,22,21,20,22,23,21] },
        hum:  { day: [50,49,48,47,48], week: [51,50,49,48,48,49,50], all: [50,49,48,47,48,49,50,51,49,48] },
        lux:  { day: [100,120,150,130,110], week: [110,120,130,125,120,110,100], all: [100,120,150,130,110,120,130,125,120,110] }
      };
      const labels = period === 'day'
        ? ["08:00", "12:00", "16:00", "20:00", "24:00"]
        : period === 'week'
        ? ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"]
        : Array.from({length: 10}, (_, i) => `–î${i+1}`);
      const data = demo[currentParam][period] || demo[currentParam].day;
      const lastValue = data[data.length - 1];
      const zone = getZoneColor(lastValue, currentParam);

      const colors = {
        success: { border: '#06d6a0', bg: 'rgba(6, 214, 160, 0.1)' },
        warning: { border: '#ffd166', bg: 'rgba(255, 209, 102, 0.1)' },
        danger:  { border: '#ef476f', bg: 'rgba(239, 71, 111, 0.1)' }
      };
      const color = colors[zone];

      const ctx = document.getElementById('climateChart').getContext('2d');
      if (climateChart) climateChart.destroy();

      climateChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: currentParam === 'temp' ? '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)' :
                  currentParam === 'hum'  ? '–í–ª–∞–∂–Ω–æ—Å—Ç—å (%)' : '–û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å (–ª–∫)',
            data,
            borderColor: color.border,
            backgroundColor: color.bg,
            borderWidth: 3,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } }
        }
      });
    }

    window.onload = () => {
      // Mock login check
      if (!isUserLoggedIn()) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç');
        // window.location.href = 'login.html';
      }
      
      // Activate first parameter button by default
      const firstParamBtn = document.querySelector('#paramButtons .btn');
      if (firstParamBtn) {
        firstParamBtn.classList.replace('btn-outline', 'btn-primary');
        currentParam = firstParamBtn.dataset.param;
        document.getElementById('paramName').textContent = '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞';
        document.getElementById('paramHint').style.display = 'block';
        document.getElementById('periodButtons').style.display = 'block';
        
        // Activate first period button
        const firstPeriodBtn = document.querySelector('#periodButtons .btn');
        if (firstPeriodBtn) {
          firstPeriodBtn.classList.replace('btn-outline', 'btn-primary');
          currentPeriod = firstPeriodBtn.dataset.period;
          loadChart(currentPeriod);
        }
      }
    };
  </script>
</body>
</html>

